<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="{{ base_url }}/public/css/app.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>
    <!-- Container -->
    <div class="container mx-auto">
        <div class="flex justify-center px-6 my-12">
            <!-- Row -->
            <div class="w-full xl:w-3/4 lg:w-11/12 flex">
                <!-- Col -->
                <div class="w-full h-auto bg-gray-400 hidden lg:block lg:w-5/12 bg-cover rounded-l-lg"
                    style="background-image: url('https://source.unsplash.com/Mv9hjnEUHR4/600x800')"></div>
                <!-- Col -->
                <div class="w-full lg:w-7/12 bg-white p-5 rounded-lg lg:rounded-l-none">
                    <h3 class="pt-4 text-2xl text-center">Create an Account!</h3>
                    <form class="px-8 pt-6 pb-8 mb-4 bg-white rounded">
                        <div class="mb-4 md:flex md:justify-between">
                            <div class="mb-4 md:mr-2 md:mb-0">
                                <label class="block mb-2 text-sm font-bold text-gray-700" for="fullname">
                                    Full Name
                                </label>
                                <input
                                    class="w-full px-3 py-2 text-sm leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline"
                                    id="fullname" type="text" placeholder="Full Name" />
                            </div>
                            <div class="md:ml-2">
                                <label class="block mb-2 text-sm font-bold text-gray-700" for="phone_num">
                                    Phone Number
                                </label>
                                <input
                                    class="w-full px-3 py-2 text-sm leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline"
                                    id="phone_num" type="text" placeholder="09xx xxx xxx"
                                    onchange="isPhoneExistInDatabase()" />
                                <p class="text-xs italic"></p>

                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-bold text-gray-700" for="email">
                                Email
                            </label>
                            <input
                                class="w-full px-3 py-2 text-sm leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline"
                                id="email" type="email" placeholder="Email" onchange="checkEmail()" />
                            <p class="text-xs italic"></p>

                        </div>
                        <div class="mb-4 md:flex md:justify-between">
                            <div class="mb-4 md:mr-2 md:mb-0">
                                <label class="block mb-2 text-sm font-bold text-gray-700" for="password">
                                    Password
                                </label>
                                <input
                                    class="w-full px-3 py-2 text-sm leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline"
                                    id="password" type="password" placeholder="******************" />
                                <!-- <p class="text-xs italic text-red-500">Please choose a password.</p> -->
                            </div>
                            <div class="md:ml-2">
                                <label class="block mb-2 text-sm font-bold text-gray-700" for="c_password">
                                    Confirm Password
                                </label>
                                <input
                                    class="w-full px-3 py-2 mb-3 text-sm leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline"
                                    id="c_password" type="password" placeholder="******************"
                                    onchange="checkPassword()" />
                                <p class="text-xs italic"></p>
                            </div>
                        </div>
                        <div class="mb-6 text-center">
                            <button
                                class="w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-full hover:bg-blue-700 focus:outline-none focus:shadow-outline"
                                type="button" onclick="signup()">
                                Register Account
                            </button>
                        </div>
                        <hr class="mb-6 border-t" />
                        <div class="text-center">
                            <a class="inline-block text-sm text-blue-500 align-baseline hover:text-blue-800" href="#">
                                Forgot Password?
                            </a>
                        </div>
                        <div class="text-center">
                            <a class="inline-block text-sm text-blue-500 align-baseline hover:text-blue-800"
                                href="./index.html">
                                Already have an account? Login!
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getInfo() {
            var username = document.getElementById('fullname').value;
            var userPhoneNum = document.getElementById('phone_num').value;
        }

        function isPhoneExistInDatabase() {
            var phoneNumElement = document.getElementById('phone_num');
            var userPhoneNum = phoneNumElement.value;

            var phonePattern = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/g;
            //var phonePattern = /^(\([0-9]{3}\) |[0-9]{3}-)[0-9]{3}-[0-9]{4}/;
            if (userPhoneNum !== '') {
                if (!userPhoneNum.match(phonePattern)) {
                    console.log('wrong phone number format');
                    return false;
                }
            }

            $.ajax({
                url: "{{ base_url }}/auth/checkPhonenumber",
                type: "POST",
                dataType: "json",
                data: {
                    'phone_num': userPhoneNum
                },
                success: function (response) {
                    var value = JSON.stringify(response);
                    phoneNumElement.classList.add(response.class);
                    phoneNumElement.nextElementSibling.innerText = response.message;
                    phoneNumElement.nextElementSibling.classList.add(response.classText);
                    //console.log(document.getElementById("phone_num").nextSibling);
                }
            });
            return userPhoneNum;
        }

        function checkEmail() {
            var emailElement = document.getElementById("email");
            var userEmail = emailElement.value;

            var emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;

            if (emailElement !== '') {
                if (!userEmail.match(emailRegex)) {
                    console.log("wrong email format");
                    return false;
                }
            } else {
                console.log("plz input your email");
                return false;
            }

            $.ajax({
                url: "{{ base_url }}/auth/checkEmail",
                type: "POST",
                dataType: "json",
                data: {
                    'email': userEmail
                },
                success: function (response) {
                    emailElement.classList.add(response.class);
                    emailElement.nextElementSibling.innerText = response.message;
                    emailElement.nextElementSibling.classList.add(response.classText)
                }
            });

            return userEmail;
        }

        function checkPassword() {
            var passElement = document.getElementById("password");
            var cPassElement = document.getElementById("c_password");

            var passwdValue = passElement.value;
            var cpasswdValue = cPassElement.value;

            if (passwdValue != cpasswdValue) {
                cPassElement.classList.add('border-red-500');
                cPassElement.nextElementSibling.classList.add('text-red-500');
                cPassElement.nextElementSibling.innerText = "Password not match";
                return false;
            }

            return passwdValue;
        }

        function signup() {
            var username = document.getElementById("fullname").value;
            if (!checkEmail() || !checkPassword() || !isPhoneExistInDatabase() || username == "") {
                alert("Thiếu hoặc sai trường, mời nhập lại");
                return;
            }

            var userInfo = {
                '_name':username,
                '_phone': isPhoneExistInDatabase(),
                '_email': checkEmail(),
                '_passwd': checkPassword()
            }

            $.ajax({
                url: "{{ base_url }}/admin/regist",
                dataType: "json",
                type: "POST",
                data: {
                    user: userInfo
                },
                success: function (response) {
                    var value = JSON.stringify(response);

                    console.log(value);
                }
            });
        }
    </script>
</body>

</html>